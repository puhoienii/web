;/*FB_PKG_DELIM*/

__d("MAWBumpThread",["ODS","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a.description;var b=a.lastActivityTs,c=a.lastMessageCtaType,e=a.lastReadTs,f=a.snippet,g=a.snippetSenderContactId,i=a.threadKey;a=a.txn;i=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(i)));if(i==null)return(h||(h=d("ODS"))).bumpEntityKey(3185,"armadillo_thread_bump","missing_thread");f=(f=f)!=null?f:i.snippet;g=(g=g)!=null?g:i.snippetSenderContactId;c=babelHelpers["extends"]({},i,{lastActivityTimestampMs:(b=b)!=null?b:i.lastActivityTimestampMs,lastMessageCtaType:c,lastReadWatermarkTimestampMs:(b=e)!=null?b:i.lastReadWatermarkTimestampMs,snippet:f,snippetSenderContactId:g});yield a.threads.put(c)});return i.apply(this,arguments)}g.threadMutation_DEPRECATED=a}),98);
__d("MAWCreateOptimisticSecureMessage",["EntMessageReplyType","I64","LSAuthorityLevel","LSIntEnum","LSMessageReplySourceType","LSMessageReplySourceTypeV2","LSMessageSendStatus","LSQuickReplyType","LSReplyMessageAttachmentType","LSReplyMessageStatus","MAWBridgeBuildMsg","MAWMsgReplySnippet","MessagingAttachmentType","QPLUserFlow","ReQL","asyncToGeneratorRuntime","isMWBumpMessage","qpl","sendToSentQPLLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b,c,d){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){if(e==null)return[void 0,void 0];var g=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.messages).getKeyRange(b,e.timestampMs,e.messageId)));c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"get_reply_msg_end",{instanceKey:f});a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachments).getKeyRange(b,e.messageId)));c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"get_reply_attachment_end",{instanceKey:f});return[g,a]});return k.apply(this,arguments)}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.contacts).getKeyRange(b)));return a==null?void 0:a.firstName});return m.apply(this,arguments)}function n(a,b,c,d){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){if(b==null)return;var g=c("isMWBumpMessage")(b.replyType)&&b.replyToUserId!=null?b.replyToUserId:b.senderId;a=(yield l(a,g));return(f=d("MAWMsgReplySnippet").buildLocalizedReplySnippet({isAuthorMe:!0,isBumpMsg:f,isDeletedMsg:b.replyStatus===c("LSReplyMessageStatus").DELETED,recipientName:a,replySenderIsMe:(h||(h=d("I64"))).equal(g,e)}))==null?void 0:f.toString()});return o.apply(this,arguments)}function p(a){if(a==null)return;var b=a.attachmentType;return(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE))||(h||(h=d("I64"))).equal(b,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").STICKER))?a.previewUrl:void 0}function q(a){if(a!=null){if((h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE)))return(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").PHOTO);if((h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").STICKER)))return(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").STICKER);if((h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO)))return(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").VIDEO);if((h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").ANIMATED_IMAGE)))return(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").GIF);return(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").EPHEMERAL_IMAGE))||(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").EPHEMERAL_VIDEO))?(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").EPHEMERAL_RAVEN_MESSAGE):(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").OTHER)}}function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h,k,l,m,o,r,s,t,u){var v=(yield d("sendToSentQPLLogger").measureSendToSentPerformance("optimistic_message_get_reply",l,function(){return j(b,h,f,l)})),w=v[0];v=v[1];g=d("MAWBridgeBuildMsg").buildOptimisticMessage(g,w,m,t);m=(yield d("sendToSentQPLLogger").measureSendToSentPerformance("optimistic_message_reply_snippet",l,function(){return n(a,w,e,u===!0)}));t=babelHelpers["extends"]({},g,{authorityLevel:(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),displayedContentTypes:i.ofNumber(s),hasQuickReplies:!1,hotEmojiSize:k,isAdminMessage:!1,isCollapsed:!1,isUnsent:!1,messageId:o,offlineThreadingId:o,primarySortKey:r,quickReplyType:i.ofNumber(c("LSQuickReplyType").NONE),replyAttachmentType:q(v),replyMediaPreviewHeight:v==null?void 0:v.previewHeight,replyMediaPreviewWidth:v==null?void 0:v.previewWidth,replyMediaUrl:p(v),replyMediaUrlMimeType:v==null?void 0:v.playableUrlMimeType,replySnippet:m,replySourceId:f==null?void 0:f.messageId,replySourceType:f!=null?(i||(i=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceType").MESSAGE):void 0,replySourceTypeV2:f!=null?(i||(i=d("LSIntEnum"))).ofNumber(c("LSMessageReplySourceTypeV2").MESSAGE):void 0,replyType:u===!0?(i||(i=d("LSIntEnum"))).ofNumber(c("EntMessageReplyType").BUMP):void 0,senderId:e,sendStatus:i.ofNumber(c("LSMessageSendStatus").SENDING_TO_SERVER),sendStatusV2:i.ofNumber(1),textHasLinks:!1,threadKey:h,timestampMs:r,transportKey:"WhatsApp",viewFlags:i.ofNumber(0)});return t});return r.apply(this,arguments)}g.buildOptimisticLsMessage=a}),98);
__d("MAWOptimisticMessageUtils",["I64","LSAuthorityLevel","LSHotEmojiSize","LSIntEnum","MAWAckLevel","MAWAdminMsg","MAWBridgeBuildMsgMentions","MAWBumpThread","MAWLocalizationType","MAWMsgType","MAWThreadUpdateMiddlewareGatingUtil","MessagingAttachmentType","ReQL","WAJids","WATimeUtils","asyncToGeneratorRuntime","cr:2472"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(){return d("WATimeUtils").millisTime()}function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.threads.index("lastActivityTimestampMs"))));return a==null||(h||(h=d("I64"))).equal(a.threadKey,b)?null:(h||(h=d("I64"))).add(a.lastActivityTimestampMs,h.one)});return k.apply(this,arguments)}function e(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=e.hotEmojiSize,g=e.mentionedJids,k=e.messageText,l=e.senderId;e=e.threadKey;k=b("cr:2472")==null?k:b("cr:2472").unvault(k);f=f!=null&&(h||(h=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").SMALL))&&k==="\ud83d\udc4d";f=f?"(Y)":m(k,g);k=!d("MAWThreadUpdateMiddlewareGatingUtil").isMAWCacheServiceEnabled();g=k?d("MAWAdminMsg").buildLocalizedString([f],[],d("MAWLocalizationType").CURRENT_USER_SEND_TEXT):void 0;f=(yield j(a,e));yield d("MAWBumpThread").threadMutation_DEPRECATED({description:"MAWOptimisticMessageUtils",lastActivityTs:f,lastReadTs:f,snippet:g,snippetSenderContactId:k?l:void 0,threadKey:e,txn:a})});return l.apply(this,arguments)}function m(a,b){b=d("MAWBridgeBuildMsgMentions").buildThreadSnippetWithMentions(a,b,[],d("MAWLocalizationType").CURRENT_USER_SEND_TEXT);var c=b[0];b[1];return(b=c)!=null?b:a}function f(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=b.optimisticMediaAttachment,e=b.senderId;b=b.threadKey;c=r(c.type);if(c!=null){var f=(yield j(a,b));yield d("MAWBumpThread").threadMutation_DEPRECATED({description:"MAWCreateOptimisticSecureMessageWithAttachment",lastActivityTs:f,lastReadTs:f,snippet:c,snippetSenderContactId:e,threadKey:b,txn:a})}});return n.apply(this,arguments)}function o(a){var b=a.ephemeralSettings,c=a.externalId,e=a.threadJid;a=a.ts;return{ack:d("MAWAckLevel").ACK.partialOptimistic,altIndex:void 0,author:d("WAJids").AUTHOR_ME,ephemeralSetting:(b=b)!=null?b:void 0,externalId:c,isForwarded:!1,specialTextSize:void 0,threadJid:e,ts:d("WATimeUtils").castMilliSecondsToUnixTime(a)}}function p(a){var b=a.commands,c=a.content,d=a.initiatingSource,e=a.isFirstMsg,f=a.mentionedJids,g=a.optimisticMsg,h=a.quote,i=a.specialTextSize;a=a.threadSource;return{commands:b==null?void 0:b.slice(),content:c,initiatingSource:d,isFirstMsg:e,isForwarded:!1,mentionedJids:f==null?void 0:f.slice(),openMessageOtid:void 0,openMessageParticipantCount:void 0,optimisticMsg:g,participantCount:void 0,quote:h,source:a,specialTextSize:i}}function q(a){var b=a.optimisticMediaAttachment,e=a.threadKey,f=a.timestampMsI64;e={actionUrl:a.actionUrl,attachmentFbid:a.offlineAttachmentId,attachmentIndex:(h||(h=d("I64"))).zero,attachmentType:a.attachmentType,authorityLevel:(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),filename:b==null?void 0:b.filename,hasMedia:!h.equal(a.attachmentType,i.ofNumber(c("MessagingAttachmentType").XMA)),hasXma:h.equal(a.attachmentType,i.ofNumber(c("MessagingAttachmentType").XMA)),isHd:a.isHd,isSharable:!1,messageId:a.messageExternalId,offlineAttachmentId:a.offlineAttachmentId,receiverFetchId:a.contentRef,subtitleText:a.subtitleText,threadKey:e,timestampMs:f,titleText:a.titleText,transportKey:"WhatsApp",xmaContentType:a.xmaContentType};if(b){e=babelHelpers["extends"]({},e,{filesize:(h||(h=d("I64"))).of_float(b.file.size),previewUrl:b.url});if(b.type==="image"||b.type==="animated_image"||b.type==="video"||b.type==="sticker"){e=babelHelpers["extends"]({},e,{previewHeight:((f=b.thumbnailSpec)==null?void 0:f.height)?(h||(h=d("I64"))).of_float((a=b.thumbnailSpec)==null?void 0:a.height):void 0,previewWidth:((f=b.thumbnailSpec)==null?void 0:f.width)?(h||(h=d("I64"))).of_float((a=b.thumbnailSpec)==null?void 0:a.width):void 0})}}return e}function r(a){switch(a){case"animated_image":return d("MAWAdminMsg").buildLocalizedString([],[],d("MAWLocalizationType").CURRENT_USER_SEND_GIF);case"image":return d("MAWAdminMsg").buildLocalizedString([],[],d("MAWLocalizationType").CURRENT_USER_SEND_IMAGE);case"video":return d("MAWAdminMsg").buildLocalizedString([],[],d("MAWLocalizationType").CURRENT_USER_SEND_VIDEO);case"audio":return d("MAWAdminMsg").buildLocalizedString([],[],d("MAWLocalizationType").CURRENT_USER_SEND_AUDIO);case"document":return d("MAWAdminMsg").buildLocalizedString([],[],d("MAWLocalizationType").CURRENT_USER_SEND_ATTACHMENT);case"sticker":return d("MAWAdminMsg").buildLocalizedString([],[],d("MAWLocalizationType").CURRENT_USER_SEND_STICKER);default:return null}}function s(a){switch(a){case(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").STICKER):return d("MAWMsgType").MSG_TYPE.STICKER;case(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE):return d("MAWMsgType").MSG_TYPE.IMAGE;case(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").ANIMATED_IMAGE):return d("MAWMsgType").MSG_TYPE.GIF;case(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO):return d("MAWMsgType").MSG_TYPE.VIDEO;case(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO):return d("MAWMsgType").MSG_TYPE.PTT;default:return d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE}}function t(a){if(a==null)return;if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").SMALL)))return 1;if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").MEDIUM)))return 2;if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").LARGE)))return 3}g.getOptimisticMessageTimestamp=a;g.getOptimisticThreadBumpTimestamp=j;g.optimisticBumpThread=e;g.optimisticBumpThreadMedia=f;g.buildMAWOptimisticBaseMsg=o;g.buildMAWBaseSendMsgArgs=p;g.buildOptimisticAttachment=q;g.lsAttachmentTypeToMsgType=s;g.getSpecialTextSize=t}),98);
__d("MAWSendFileMsgTypes",["WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a}function b(a){return d("WAStanzaUtils").toStanzaId(a)}g.toOfflineAttachmentIDFromStanzaId=a;g.toOfflineAttachmentIDFromString=b}),98);
__d("useMAWCreateOptimisticSecureMessageWithXMAAttachment",["I64","LSIntEnum","MAWAdminMsg","MAWBumpThread","MAWCreateOptimisticSecureMessage","MAWLocalizationType","MAWOptimisticMessageUtils","MAWSendFileMsgTypes","MAWVault","MWPActor.react","MessagingAttachmentType","Promise","QPLUserFlow","asyncToGeneratorRuntime","qpl","react-compiler-runtime","useAsyncReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(){var a=d("react-compiler-runtime").c(3),e=c("useAsyncReStore")(),g=d("MWPActor.react").useActor(),h;a[0]!==e||a[1]!==g?(h=function(a){var d=a.actionUrl,h=a.associatedMsgId,i=a.associatedMsgText,l=a.commands,m=a.contentRef,n=a.instanceKey,o=a.isReceiverFetch,p=a.lssTraceApi,q=a.mentionedJids,r=a.messageExternalId,s=a.messageText,t=a.offlineAttachmentId,u=a.onOfflineMsgId,v=a.optimisticMediaAttachment,w=a.reply,x=a.subtitleText,y=a.threadKey,z=a.titleText,A=a.xmaContentType,B=o===void 0?!1:o;return(j||(j=b("Promise"))).resolve(e).then(function(a){c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"before_create_optimistic_message_restore_resolved",{instanceKey:n});return a.runInTransaction(function(b){return k({actionUrl:d,associatedMsgId:h,associatedMsgText:i,commands:l,contentRef:m,db:a,instanceKey:n,isReceiverFetch:B,lssTraceApi:p,mentionedJids:q,messageExternalId:r,messageText:s,offlineAttachmentId:t,onOfflineMsgId:u,optimisticMediaAttachment:v,reply:w,senderId:g,subtitleText:x,threadKey:y,titleText:z,txn:b,xmaContentType:A})},"readwrite","ui",void 0,f.id+":95")})},a[0]=e,a[1]=g,a[2]=h):h=a[2];return h}function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b,e=a.actionUrl,f=a.associatedMsgId,g=a.associatedMsgText,j=a.commands,k=a.contentRef,l=a.db,m=a.instanceKey,n=a.isReceiverFetch;n=n===void 0?!1:n;var o=a.lssTraceApi,p=a.mentionedJids,q=a.messageExternalId,r=a.messageText,s=a.offlineAttachmentId,t=a.onOfflineMsgId,u=a.optimisticMediaAttachment,v=a.reply,w=a.senderId,x=a.subtitleText,y=a.threadKey,z=a.titleText,A=a.txn;a=a.xmaContentType;t(q);o==null?void 0:o.addMarkerPoint("set_offline_message_external_id_for_ls_message","AppTiming");t=d("MAWOptimisticMessageUtils").getOptimisticMessageTimestamp();o=(h||(h=d("I64"))).of_float(t);n=n?536870912:1024;b=(yield d("MAWCreateOptimisticSecureMessage").buildOptimisticLsMessage(l,A,w,v,(b=d("MAWVault").unvault(r))!=null?b:"",y,void 0,m,p,q,o,n,j));yield A.messages.add(b);n=d("MAWOptimisticMessageUtils").buildOptimisticAttachment({actionUrl:e,attachmentType:(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA),contentRef:k,messageExternalId:q,offlineAttachmentId:s,optimisticMediaAttachment:u,senderId:w,subtitleText:x,threadKey:y,timestampMsI64:o,titleText:z,xmaContentType:a});yield A.attachments.add(n);if(f!=null&&g!=null&&g!==""){e=(yield d("MAWCreateOptimisticSecureMessage").buildOptimisticLsMessage(l,A,w,v,(b=d("MAWVault").unvault(g))!=null?b:"",y,void 0,m,p,f,o,1,j));yield A.messages.add(e)}c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"after_create_optimistic_message",{instanceKey:m});c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"optimistic_bump_thread_start",{instanceKey:m});yield d("MAWBumpThread").threadMutation_DEPRECATED({description:"useMAWCreateOptimisticSecureMessageWithXMAAttachment",lastActivityTs:o,lastReadTs:o,snippet:d("MAWAdminMsg").buildLocalizedString([d("MAWVault").unvault(r)],[],d("MAWLocalizationType").CURRENT_USER_SEND_TEXT),snippetSenderContactId:w,threadKey:y,txn:A});c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"optimistic_bump_thread_end",{instanceKey:m});return{messageExternalId:q,offlineAttachmentId:d("MAWSendFileMsgTypes").toOfflineAttachmentIDFromString(s),offlineMsgTimestamp:t}});return l.apply(this,arguments)}g.useMAWCreateOptimisticSecureMessageWithXMAAttachment=a}),98);